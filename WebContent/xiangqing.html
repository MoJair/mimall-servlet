<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>立即购买-小米商城</title>
		<link rel="short icon" href="./images/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" type="text/css" href="./css/style.css">
		<!-- 收藏夹图标 -->
		<link rel="shortcut icon" href="./images/favicon.ico">
		<!-- 先引入重置的CSS样式文件 -->
		<link rel="stylesheet" href="./css/reset.css">
		<!-- 引入字体图标的css文件 -->
		<link rel="stylesheet" href="./css/iconfont.css">	
		<!-- 引入当前页面的CSS文件 -->
		<link rel="stylesheet" href="./css/index.css">
	</head>
	<body>
	<!-- start header -->
		<div id="login_info">	
		<!-- 顶部导航 start -->
		<div class="header_bar">
			<div class="header con_width">
				<!-- 左侧菜单 -->
				<div class="header_nav">
					<ul>
						<li><a href="#">小米商城</a></li>
						<li><a href="#">MIUI</a></li>
						<li><a href="#">IoT</a></li>
						<li><a href="#">云服务</a></li>
						<li><a href="#">金融</a></li>
						<li><a href="#">有品</a></li>
						<li><a href="#">小爱开放平台</a></li>
						<li><a href="#">企业团购</a></li>
						<li><a href="#">资质证照</a></li>
						<li><a href="#">协议规则</a></li>
						<li><a href="#">下载app</a></li>
						<li><a href="#">Select Location</a></li>
					</ul>
				</div>
				<!-- 右侧购物车 -->
				<div class="header_shopcart">
					<div class="shopcart_logo">
						<a href="front/gouwuche.html">
							<i class="iconfont icon-cart"></i>
							购物车（{{cartCount}}）
						</a>
					</div>
				</div>
				<!--右侧登录、注册-->
				<div class="user-auction" v-if="onlogin">
					<ul>
						<li><div class="header_user">
								<div class="user_logo">
									<a href="#">{{loginName}}</a>
									<div class="user_info">
										<ul><li><a href="front/self_info.html" target="_blank">个人中心</a></li></ul>
										<ul><li><a href="front/order.html" target="_blank">我的订单</a></li></ul>
										<ul><li><a href="javascript:void(0);" target="_blank">我的喜欢</a></li></ul>
										<ul><li><a href="" target="_blank">退出登录</a></li></ul>
									</div>
								</div>
						</div></li>
						<li><a href="./register.html" target="_blank">注册</a></li>
						<!--<li><a href="#">消息通知</a></li>-->
					</ul>
				</div>
				<div class="user-auction" v-else="onlogin">
					<ul>
						<li><a href="./login.html" target="_blank">登录</a></li>
						<li><a href="./register.html" target="_blank">注册</a></li>
						<!--<li><a href="#">消息通知</a></li>-->
					</ul>
				</div>
			</div>
		</div>
		</div>
		<!-- 顶部导航 end -->
	<!--end header -->

<!-- start banner_x -->
		<!-- 主体导航 start -->
		<div id="look">
		<div class="main_nav con_width">
			<div class="logo">
				<img src="./images/mi-logo.png" alt="MIlogo" title="小米官网">
			</div>
			<a href=""><div class="runlogo"></div></a>
			<div class="nav">
				<ul>
					<li v-for="type in types"><a href="./liebiao.html" target="_blank" >小米{{type.tname}}</a>
						<div class="nav_item">
							<div class="nav_item_con con_width">
								<ul>
									<li  v-for="good in goods" v-if="good.tno == type.tno">
										<a :href="'xiangqing.html#' +good.pid + '&'" class="nav_item_con_img">
											<img :src="good.pics.split(',')[0]" />
										</a>
										<a :href="'xiangqing.html#' +good.pid + '&'" class="nav_item_con_name">{{good.pname}}</a>
										<p>{{good.price}}元</p>
									</li>
								</ul>
							</div>
						</div>
					</li>
					<li><a href="#">服务</a></li>
					<li><a href="#">社区</a></li>
				</ul>
			</div>
			<!-- 搜索部分 start -->
			<div class="search_box">
					<input type="search" name="search" class="search" />
					<button onclick="Search()" >
						<i class="iconfont icon-sousuo" ></i>
					</button>
			</div>
			<!-- 搜索部分 end -->
		</div>
		</div>
		<!-- 主体导航 end -->
<!-- end banner_x -->

	<div id="app">
	<!-- xiangqing -->
	<form action="post" method="">
	<div class="xiangqing">
		<div class="neirong w">
			<div class="xiaomi6 fl">{{goods.pname}}</div>
			<nav class="fr">
				<li><a href="">概述</a></li>
				<li>|</li>
				<li><a href="">变焦双摄</a></li>
				<li>|</li>
				<li><a href="">设计</a></li>
				<li>|</li>
				<li><a href="">参数</a></li>
				<li>|</li>
				<li><a href="">F码通道</a></li>
				<li>|</li>
				<li><a href="">用户评价</a></li>
				<div class="clear"></div>
			</nav>
			<div class="clear"></div>
		</div>	
	</div>
	
	<div class="jieshao mt20 w">
		<div class="left fl" id="left_f1"><img  v-for="pic in pics" :src="pic"></div>
		<div class="right fr">
			<div class="h3 ml20 mt20">{{goods.pname}}</div>
			<div class="jianjie mr40 ml20 mt10">{{goods.intro}}</div>
			<div class="jiage ml20 mt10">{{goods.price}}元</div>
			<div class="ft20 ml20 mt20">选择版本</div>
			<div class="xzbb ml20 mt10">
				<div class="banben fl"  v-for="(item,index) in versions">
					<a @click="change(index)" >
						<span>{{item}}&nbsp;&nbsp;&nbsp;{{prices[index]}}元</span>
					</a>
				</div>
				<div class="clear"></div>
			</div>
			<div class="ft20 ml20 mt20">选择颜色</div>
			<div class="xzbb ml20 mt10">
				<div class="banben fl" v-for="(item,index) in colors">
					<a @click="changecolor(index)">
						<span class="yuandian"></span>
						<span class="yanse" >{{item}}</span>
					</a>
				</div>
				
			</div>
			<div class="xqxq mt20 ml20">
				<div class="top1 mt10">
					<div class="left1 fl" ><i id="i1"></i>&nbsp;&nbsp;&nbsp;<i id="i2"></i></div>
					<div class="right1 fr"><i id="i3"></i></div>
					<div class="clear"></div>
				</div>
				<div class="bot mt20 ft20 ftbc"><i id="i4"></i></div>
			</div>
			<div class="xiadan ml20 mt20">
					<input class="jrgwc"  type="button" name="jrgwc" value="立即选购" />
					<input class="jrgwc" type="button" name="jrgwc" @click="addCar()" value="加入购物车" />
				
			</div>
		</div>
		<div class="clear"></div>
	</div>
	</form>
	</div>
	<div class="clear"></div>
	<!-- footer -->
	<footer class="mt20 center">
			
			<div class="mt20">小米商城|MIUI|米聊|多看书城|小米路由器|视频电话|小米天猫店|小米淘宝直营店|小米网盟|小米移动|隐私政策|Select Region</div>
			<div>©mi.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2014]0059-0009号</div> 
			<div>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</div>

		</footer>

	</body>
	<script type="text/javascript" charset="utf-8" src="./js/index.js"></script>
	<script src="js/vue.js"  type="text/javascript"></script>
	<script src="js/axios.js" type="text/javascript"></script>
	<script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
	<script src="js/qs.js"  type="text/javascript"></script>
	<script src="js/checklogin.js"  type="text/javascript"></script>
	<script type="text/javascript">
	let look = new Vue({
		el:"#look",
		data:{
			goods:[],
			types:[]
		},
		methods:{
			
		},
		mounted:function(){//页面加载完执行的方法
		
			axios.post("goods",qs.stringify({op:"findIndex"})).then(result =>{
				if(result.data.code ==200){
					this.types = result.data.data.types;
					this.goods = result.data.data.goods;
				}
			})
		}
		
	})

	function Search(){
		var pname="";
		pname = $.trim($(".search").val());
		if(pname==""){
			return;
		}
		localStorage.removeItem("pname");
		localStorage.setItem("pname",pname);
		location.href="liebiao.html";	
		
	}
	
	
	
	
	
	let vm = new Vue({
		el:"#app",
		data:{
			goods:{},
			pics:[],
			prices:[],
			colors:[],
			versions:[]
		},
		methods:{
			change: function(num){
				$("#i1").text(this.versions[num]);
				$("#i3").text(this.prices[num]+"元");
				$("#i4").text("总计 ："+this.prices[num]+"元");
			},
			changecolor: function(num){
				$("#i2").text(this.colors[num]);
			},
			addCar: function(){
				
				//先判断是否登录
				if(!login.$data.loginId){
					location.href="login.html";
					return;
				}
				let lcarts = login.$data.carts;
				console.info(lcarts);
				//存在就修改数量
				if(lcarts.length>0){
					for(let i=0,len=lcarts.length;i<len;i++){
						if(lcarts[i].pid == this.goods.pid){
							axios.post("cart",qs.stringify({op:"update",pid:this.goods.pid,num:"1",cno:lcarts[i].cno})).then(result =>{
								if(result.data.code==200){
									alert("加入购物车成功");
								}else{
									alert("加入购物车失败");
								}
							})
							return;
						}
					}
				}
				axios.post("cart",qs.stringify({op:"add",pid:this.goods.pid,num:"1",uid:login.$data.loginId})).then(result =>{
								if(result.data.code==200){
									login.$data.cartCount = login.$data.cartCount+1;
									let newobj ={};
									newobj.cno = result.data.msg;
									newobj.gno = result.data.gno;
									login.$data.carts.push(newobj);
									alert("加入购物车成功");
								}else{
									alert("加入购物车失败");
								}
							})
				//判断商品是否存在
				
				//否则添加
			}
		},
		mounted: function(){
			axios.all([getGoodsByPid()]).then(axios.spread((result) =>{
				this.goods = result.data.data;
				this.pics = result.data.data.pics.split(",");
				this.prices = result.data.data.price.split("-");
				this.versions = result.data.data.version.split(",");
				this.colors = result.data.data.color.split(",");
				this.$nextTick(function(){
					showPics();
				})
			}));
		}
	})
	function getGoodsByPid(){
		var hash = decodeURI(location.hash);
		if(hash==""|| hash.indexOf("&")<=0){
			location.href="index.html";
			return;
		}
		hash = hash.replace("#","").split("&");
		return axios.post("goods",qs.stringify({op:"findByPid",pid:hash[0]}));
	}
	function showPics(){
		var imglen = $("#left_f1>img").length;
		if(imglen > 1){
			var i = 0 ;
			setInterval(() => {
				$("#left_f1>img").css("display","none");
				$("#left_f1>img").eq(i).css("display","block");
				i = (i+1) % imglen;
			}, 2000);
		}
	}
		
			//立即购买
			$("#buy_btn").click(function(){
				location.href = "order.html";
			});
	
	</script>
</html>